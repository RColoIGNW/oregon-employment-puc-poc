FROM node:10.19.0-alpine3.11

RUN apk --update add git less openssh && \
    rm -rf /var/lib/apt/lists/* && \
    rm /var/cache/apk/*

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run typegen

ENV ENABLE_GATSBY_REFRESH_ENDPOINT=true

EXPOSE 8000

CMD ["npm", "run", "preview"]